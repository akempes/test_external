#!/usr/bin/env bash

function makeprojectfolder() {
    echo "Creating project folder"
    mkdir "$1"
    cd "$1"
}

function gitinit() {
    echo "Add git & submodule"
    git init
    git add -A && git commit -m "Initial commit"
    git submodule add -b 2.0 https://app.buddy.works/7lab/7lab-docker
    git add -A && git commit -m "Submodule added"

}

function vessel() {
    PROJECT_DIR=$(pwd)
    DOCKER_DIR="7lab-docker"

    if [ -d $DOCKER_DIR ]; then
        cd $DOCKER_DIR
        bash vessel "$PROJECT_DIR" "$@"
        cd $PROJECT_DIR
    else
        echo -e "\033[31mNo '$DOCKER_DIR' directory found within current working directory '$PROJECT_DIR'\033[0m"
    fi
}

function success() {
    echo -e "\033[1m\033[32mInstallation completed!\033[0m"
}

cd $1

if [ "$3" == "" ]; then
    
    echo -e "\033[31mNo project name is specified! Correct usage: 7 install [framework] [project_name]\033[0m"

elif [ "$2" == "laravel" ]; then
    
    echo "Installing Laravel"
    makeprojectfolder $3
    git clone https://github.com/laravel/laravel.git $(pwd)
    rm -rf !$/.git
    
    gitinit
    vessel init
    success

elif [ "$2" == "wordpress" ]; then

    echo "Installing Wordpress"
    makeprojectfolder $3
    success


elif [ "$2" == "none" ]; then

    echo "Creating an empty project"
    makeprojectfolder $3
    gitinit
    success

else

    echo -e "\033[31mThis framework not supported! Supported frameworks are: none, laravel and wordpress\033[0m"

fi
